<!DOCTYPE html>
<html lang="en" dir="ltr">
<meta name="viewport" content="width=device-width, initial-scale=1">
<head>
    <meta charset="utf-8">
    <title>Edit Campaign</title>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@100..800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <style>
        :root {
            --background-color: #f4f4f9;
            --text-color: #333;
            --header-background: #666;
            --header-color: #fff;
            --primary-color: #2563eb;
            --success-color: #22c55e;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --border-radius: 12px;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            box-sizing: border-box;
            font-family: "Lexend", "Helvetica Neue", "Helvetica", sans-serif;
            font-size: 16px;
        }

        @media (max-width: 768px) {
            :root {
                font-size: 14px;
            }
        }

        * {
            box-sizing: inherit;
            margin: 0;
            padding: 0;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            line-height: 1.5;
        }

        main {
            width: 100%;
            max-width: 1024px;
            margin: 20px auto;
            padding: 20px;
        }

        .container {
            display: grid;
            gap: 24px;
        }

        .card {
            background: #fff;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 24px;
            transition: box-shadow 0.3s ease;
        }

        .card:hover {
            box-shadow: var(--shadow-lg);
        }

        .campaign-header {
            display: grid;
            gap: 24px;
            grid-template-columns: 2fr 1fr;
        }

        @media (max-width: 768px) {
            .campaign-header {
                grid-template-columns: 1fr;
            }
        }

        .campaign-title {
            font-size: 2.5rem;
            line-height: 1.2;
            margin-bottom: 16px;
            color: var(--text-color);
        }

        .campaign-description {
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 24px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 24px;
        }

        .stat-card {
            background: #f8fafc;
            padding: 16px;
            border-radius: var(--border-radius);
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .stat-label {
            font-size: 0.875rem;
            color: #666;
            margin-top: 4px;
        }

        #map {
            width: 100%;
            height: 300px;
            border-radius: var(--border-radius);
            margin-top: 16px;
        }

        .progress-container {
            margin: 24px 0;
        }

        .progress-bar {
            background-color: #e2e8f0;
            border-radius: 9999px;
            overflow: hidden;
            height: 24px;
            margin: 8px 0;
        }

        .progress-bar div {
            height: 100%;
            background-color: var(--success-color);
            transition: width 1s ease-in-out;
        }

        .progress-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.875rem;
            color: #666;
        }

        .section-title {
            font-size: 1.5rem;
            margin-bottom: 16px;
            color: var(--text-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-title-actions {
            display: flex;
            gap: 8px;
        }

        .impact-metrics, .milestones {
            list-style: none;
        }

        .impact-metrics li, .milestones li {
            padding: 12px 16px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .impact-metrics li:last-child, .milestones li:last-child {
            border-bottom: none;
        }

        .media-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .media-item {
            position: relative;
            aspect-ratio: 1;
            overflow: hidden;
            border-radius: var(--border-radius);
            background: #f8fafc;
        }

        .media-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .media-item:hover img {
            transform: scale(1.05);
        }

        .media-caption {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 8px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            font-size: 0.875rem;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .status-active {
            background-color: #dcfce7;
            color: #166534;
        }

        .status-completed {
            background-color: #dbeafe;
            color: #1e40af;
        }

        .status-pending {
            background-color: #fef9c3;
            color: #854d0e;
        }

        .link {
            color: #339;
            text-decoration: none;
            background-color: #0099ff00;
            transition: all 300ms linear;
        }
        
        .link:hover {
            color: #fff;
            text-decoration: underline;
            background-color: #0066ffcc;
        }

        /* Edit mode styles */
        .edit-mode input[type="text"],
        .edit-mode input[type="number"],
        .edit-mode textarea,
        .edit-mode select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 1rem;
            font-family: inherit;
            background-color: #f9fafb;
            transition: border-color 0.2s;
        }

        .edit-mode input:focus,
        .edit-mode textarea:focus,
        .edit-mode select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2);
        }

        .edit-mode textarea {
            min-height: 100px;
            resize: vertical;
        }

        .edit-title {
            font-size: 2.5rem;
            width: 100%;
            margin-bottom: 16px;
            font-weight: bold;
        }

        .edit-description {
            width: 100%;
            margin-bottom: 24px;
        }

        .action-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 16px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 8px 16px;
            font-size: 0.875rem;
            font-weight: 500;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #1d4ed8;
        }

        .btn-secondary {
            background-color: #f3f4f6;
            color: #4b5563;
        }

        .btn-secondary:hover {
            background-color: #e5e7eb;
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #16a34a;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #dc2626;
        }

        .btn-icon {
            width: 30px;
            height: 30px;
            padding: 0;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .item-actions {
            display: flex;
            gap: 8px;
        }

        .item-content {
            flex: 1;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px;
            border-radius: 8px;
            color: white;
            box-shadow: var(--shadow);
            z-index: 1000;
            opacity: 0;
            transform: translateY(-20px);
            transition: opacity 0.3s, transform 0.3s;
        }

        .notification.success {
            background-color: var(--success-color);
        }

        .notification.error {
            background-color: var(--danger-color);
        }

        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #4b5563;
        }

        .form-row {
            display: flex;
            gap: 16px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }

        .modal.open {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 24px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #6b7280;
        }

        .upload-area {
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 32px;
            text-align: center;
            margin-bottom: 16px;
            cursor: pointer;
            transition: border-color 0.2s;
        }

        .upload-area:hover {
            border-color: var(--primary-color);
        }

        .upload-area p {
            margin-top: 8px;
            color: #6b7280;
        }

        .file-input {
            display: none;
        }

        /* New styles for preview and social sharing */
        .preview-btn {
            background-color: var(--primary-color);
            color: white;
        }

        .preview-btn:hover {
            background-color: #1d4ed8;
        }

        .share-btn {
            background-color: #4f46e5;
            color: white;
        }

        .share-btn:hover {
            background-color: #4338ca;
        }

        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            background-color: white;
            min-width: 160px;
            box-shadow: var(--shadow);
            border-radius: var(--border-radius);
            z-index: 1;
        }

        .dropdown-content a {
            color: #374151;
            padding: 12px 16px;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .dropdown-content a:hover {
            background-color: #f3f4f6;
        }

        .dropdown:hover .dropdown-content {
            display: block;
        }

        .preview-frame {
            width: 100%;
            height: 600px;
            border: none;
            border-radius: var(--border-radius);
        }

        /* SEO Preview Card */
        .seo-preview-card {
            border: 1px solid #d1d5db;
            border-radius: 8px;
            overflow: hidden;
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin-bottom: 16px;
        }

        .seo-preview-google {
            padding: 16px;
        }

        .seo-preview-title {
            color: #1a0dab;
            font-size: 18px;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .seo-preview-url {
            color: #006621;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .seo-preview-description {
            color: #545454;
            font-size: 13px;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .seo-preview-facebook {
            border-top: 1px solid #d1d5db;
        }

        .seo-preview-image {
            width: 100%;
            height: 260px;
            background-color: #f3f4f6;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #9ca3af;
        }

        .seo-preview-facebook-content {
            padding: 12px;
            background-color: #f9fafb;
        }

        .seo-preview-facebook-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .seo-preview-facebook-description {
            font-size: 14px;
            color: #6b7280;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .seo-preview-facebook-url {
            font-size: 12px;
            color: #9ca3af;
            margin-top: 4px;
            text-transform: uppercase;
        }

        .seo-preview-twitter {
            border-top: 1px solid #d1d5db;
            padding: 16px;
        }

        .seo-preview-twitter-card {
            border: 1px solid #d1d5db;
            border-radius: 12px;
            overflow: hidden;
        }

        .seo-form-group {
            margin-bottom: 16px;
        }

        .seo-form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #4b5563;
        }

        .seo-form-group input, .seo-form-group textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.875rem;
        }

        .seo-form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .share-options {
            margin-top: 16px;
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .share-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background-color: #f9fafb;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .share-option:hover {
            background-color: #f3f4f6;
        }

        .tab-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .tab-button {
            padding: 8px 16px;
            background-color: #f3f4f6;
            border: none;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .tab-button.active {
            background-color: var(--primary-color);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .url-input-group {
            display: flex;
            margin-bottom: 16px;
        }

        .url-input-group input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-top-left-radius: 6px;
            border-bottom-left-radius: 6px;
            font-size: 0.875rem;
        }

        .url-input-group button {
            padding: 8px 12px;
            background-color: #f3f4f6;
            border: 1px solid #d1d5db;
            border-left: none;
            border-top-right-radius: 6px;
            border-bottom-right-radius: 6px;
            cursor: pointer;
        }

        .preview-devices {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .preview-device-btn {
            padding: 8px 12px;
            background-color: #f3f4f6;
            border: none;
            border-radius: 6px;
            font-size: 0.875rem;
            cursor: pointer;
        }

        .preview-device-btn.active {
            background-color: var(--primary-color);
            color: white;
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            .edit-mode input[type="text"],
            .edit-mode input[type="number"],
            .edit-mode textarea,
            .edit-mode select {
                background-color: #1f2937;
                border-color: #4b5563;
                color: #e5e7eb;
            }

            .modal-content {
                background-color: #1f2937;
                color: #e5e7eb;
            }

            .btn-secondary {
                background-color: #374151;
                color: #e5e7eb;
            }

            .btn-secondary:hover {
                background-color: #4b5563;
            }

            .dropdown-content {
                background-color: #1f2937;
            }

            .dropdown-content a {
                color: #e5e7eb;
            }

            .dropdown-content a:hover {
                background-color: #374151;
            }

            .seo-preview-google {
                background-color: #1f2937;
            }

            .seo-preview-title {
                color: #60a5fa;
            }

            .seo-preview-url {
                color: #34d399;
            }

            .seo-preview-description {
                color: #d1d5db;
            }

            .seo-preview-facebook-content,
            .share-option {
                background-color: #374151;
            }

            .seo-preview-facebook-description {
                color: #d1d5db;
            }

            .tab-button,
            .url-input-group button {
                background-color: #374151;
                color: #e5e7eb;
            }

            .preview-device-btn {
                background-color: #374151;
                color: #e5e7eb;
            }
        }
    </style>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://unpkg.com/leaflet-providers@latest/leaflet-providers.js"></script>
</head>
<body>
<main>
    <div class="container">
        <div class="action-buttons" style="margin-bottom: 16px;">
            <a class='link' href="#" onclick="history.go(-1); return false;"><i class="fa-solid fa-arrow-left-long"></i> Go back</a>
            <div style="flex: 1;"></div>
            
            <!-- Preview button with dropdown -->
            <div class="dropdown" style="margin-right: 8px;">
                <button id="preview-btn" class="btn preview-btn"><i class="fas fa-eye"></i> Preview</button>
                <div class="dropdown-content">
                    <a href="#" onclick="app.openPreviewModal('desktop'); return false;"><i class="fas fa-desktop"></i> Desktop</a>
                    <a href="#" onclick="app.openPreviewModal('tablet'); return false;"><i class="fas fa-tablet-alt"></i> Tablet</a>
                    <a href="#" onclick="app.openPreviewModal('mobile'); return false;"><i class="fas fa-mobile-alt"></i> Mobile</a>
                </div>
            </div>
            
            <!-- Share button with dropdown -->
            <div class="dropdown" style="margin-right: 8px;">
                <button id="share-btn" class="btn share-btn"><i class="fas fa-share-alt"></i> Share</button>
                <div class="dropdown-content">
                    <a href="#" onclick="app.openShareModal('facebook'); return false;"><i class="fab fa-facebook"></i> Facebook</a>
                    <a href="#" onclick="app.openShareModal('twitter'); return false;"><i class="fab fa-twitter"></i> Twitter</a>
                    <a href="#" onclick="app.openShareModal('linkedin'); return false;"><i class="fab fa-linkedin"></i> LinkedIn</a>
                    <a href="#" onclick="app.openShareModal('email'); return false;"><i class="fas fa-envelope"></i> Email</a>
                    <a href="#" onclick="app.openShareModal('link'); return false;"><i class="fas fa-link"></i> Copy Link</a>
                </div>
            </div>
            
            <!-- SEO button -->
            <button id="seo-btn" class="btn btn-secondary" style="margin-right: 8px;" onclick="app.openSeoModal()"><i class="fas fa-search"></i> SEO</button>
            
            <!-- Edit/Save buttons -->
            <button id="edit-campaign-btn" class="btn btn-primary"><i class="fas fa-edit"></i> Edit Campaign</button>
            <button id="save-campaign-btn" class="btn btn-success" style="display: none;"><i class="fas fa-save"></i> Save Changes</button>
            <button id="cancel-edit-btn" class="btn btn-secondary" style="display: none;"><i class="fas fa-times"></i> Cancel</button>
        </div>

        <div class="card campaign-header">
            <div class="campaign-info">
                <h1 id="campaign-title" class="campaign-title">Campaign Title</h1>
                <div id="campaign-title-edit" class="edit-mode" style="display: none;">
                    <input type="text" id="title-input" class="edit-title" placeholder="Campaign Title">
                </div>
                
                <p id="campaign-description" class="campaign-description"></p>
                <div id="campaign-description-edit" class="edit-mode" style="display: none;">
                    <textarea id="description-input" class="edit-description" placeholder="Campaign Description"></textarea>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="campaign-donors">0</div>
                        <div class="stat-label">Total Donors</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="campaign-location">Unknown</div>
                        <div id="location-edit" class="edit-mode" style="display: none;">
                            <div class="form-group">
                                <label for="location-region">Region</label>
                                <input type="text" id="location-region" placeholder="Region">
                            </div>
                            <div class="form-group">
                                <label for="location-country">Country</label>
                                 <select name="location-country" id="location-country">
                                    <option value="">-- Select a country --</option>
                                </select>

                                <script>
                                    // List of UN member countries with their ISO 2-character codes
                                    const unCountries = [
                                        { code: "AF", name: "Afghanistan" },
                                        { code: "AL", name: "Albania" },
                                        { code: "DZ", name: "Algeria" },
                                        { code: "AD", name: "Andorra" },
                                        { code: "AO", name: "Angola" },
                                        { code: "AG", name: "Antigua and Barbuda" },
                                        { code: "AR", name: "Argentina" },
                                        { code: "AM", name: "Armenia" },
                                        { code: "AU", name: "Australia" },
                                        { code: "AT", name: "Austria" },
                                        { code: "AZ", name: "Azerbaijan" },
                                        { code: "BS", name: "Bahamas" },
                                        { code: "BH", name: "Bahrain" },
                                        { code: "BD", name: "Bangladesh" },
                                        { code: "BB", name: "Barbados" },
                                        { code: "BY", name: "Belarus" },
                                        { code: "BE", name: "Belgium" },
                                        { code: "BZ", name: "Belize" },
                                        { code: "BJ", name: "Benin" },
                                        { code: "BT", name: "Bhutan" },
                                        { code: "BO", name: "Bolivia" },
                                        { code: "BA", name: "Bosnia and Herzegovina" },
                                        { code: "BW", name: "Botswana" },
                                        { code: "BR", name: "Brazil" },
                                        { code: "BN", name: "Brunei Darussalam" },
                                        { code: "BG", name: "Bulgaria" },
                                        { code: "BF", name: "Burkina Faso" },
                                        { code: "BI", name: "Burundi" },
                                        { code: "CV", name: "Cabo Verde" },
                                        { code: "KH", name: "Cambodia" },
                                        { code: "CM", name: "Cameroon" },
                                        { code: "CA", name: "Canada" },
                                        { code: "CF", name: "Central African Republic" },
                                        { code: "TD", name: "Chad" },
                                        { code: "CL", name: "Chile" },
                                        { code: "CN", name: "China" },
                                        { code: "CO", name: "Colombia" },
                                        { code: "KM", name: "Comoros" },
                                        { code: "CG", name: "Congo" },
                                        { code: "CD", name: "Congo, Democratic Republic of the" },
                                        { code: "CR", name: "Costa Rica" },
                                        { code: "CI", name: "Côte d'Ivoire" },
                                        { code: "HR", name: "Croatia" },
                                        { code: "CU", name: "Cuba" },
                                        { code: "CY", name: "Cyprus" },
                                        { code: "CZ", name: "Czechia" },
                                        { code: "DK", name: "Denmark" },
                                        { code: "DJ", name: "Djibouti" },
                                        { code: "DM", name: "Dominica" },
                                        { code: "DO", name: "Dominican Republic" },
                                        { code: "EC", name: "Ecuador" },
                                        { code: "EG", name: "Egypt" },
                                        { code: "SV", name: "El Salvador" },
                                        { code: "GQ", name: "Equatorial Guinea" },
                                        { code: "ER", name: "Eritrea" },
                                        { code: "EE", name: "Estonia" },
                                        { code: "SZ", name: "Eswatini" },
                                        { code: "ET", name: "Ethiopia" },
                                        { code: "FJ", name: "Fiji" },
                                        { code: "FI", name: "Finland" },
                                        { code: "FR", name: "France" },
                                        { code: "GA", name: "Gabon" },
                                        { code: "GM", name: "Gambia" },
                                        { code: "GE", name: "Georgia" },
                                        { code: "DE", name: "Germany" },
                                        { code: "GH", name: "Ghana" },
                                        { code: "GR", name: "Greece" },
                                        { code: "GD", name: "Grenada" },
                                        { code: "GT", name: "Guatemala" },
                                        { code: "GN", name: "Guinea" },
                                        { code: "GW", name: "Guinea-Bissau" },
                                        { code: "GY", name: "Guyana" },
                                        { code: "HT", name: "Haiti" },
                                        { code: "HN", name: "Honduras" },
                                        { code: "HU", name: "Hungary" },
                                        { code: "IS", name: "Iceland" },
                                        { code: "IN", name: "India" },
                                        { code: "ID", name: "Indonesia" },
                                        { code: "IR", name: "Iran" },
                                        { code: "IQ", name: "Iraq" },
                                        { code: "IE", name: "Ireland" },
                                        { code: "IL", name: "Israel" },
                                        { code: "IT", name: "Italy" },
                                        { code: "JM", name: "Jamaica" },
                                        { code: "JP", name: "Japan" },
                                        { code: "JO", name: "Jordan" },
                                        { code: "KZ", name: "Kazakhstan" },
                                        { code: "KE", name: "Kenya" },
                                        { code: "KI", name: "Kiribati" },
                                        { code: "KP", name: "Korea, Democratic People's Republic of" },
                                        { code: "KR", name: "Korea, Republic of" },
                                        { code: "KW", name: "Kuwait" },
                                        { code: "KG", name: "Kyrgyzstan" },
                                        { code: "LA", name: "Lao People's Democratic Republic" },
                                        { code: "LV", name: "Latvia" },
                                        { code: "LB", name: "Lebanon" },
                                        { code: "LS", name: "Lesotho" },
                                        { code: "LR", name: "Liberia" },
                                        { code: "LY", name: "Libya" },
                                        { code: "LI", name: "Liechtenstein" },
                                        { code: "LT", name: "Lithuania" },
                                        { code: "LU", name: "Luxembourg" },
                                        { code: "MG", name: "Madagascar" },
                                        { code: "MW", name: "Malawi" },
                                        { code: "MY", name: "Malaysia" },
                                        { code: "MV", name: "Maldives" },
                                        { code: "ML", name: "Mali" },
                                        { code: "MT", name: "Malta" },
                                        { code: "MH", name: "Marshall Islands" },
                                        { code: "MR", name: "Mauritania" },
                                        { code: "MU", name: "Mauritius" },
                                        { code: "MX", name: "Mexico" },
                                        { code: "FM", name: "Micronesia, Federated States of" },
                                        { code: "MD", name: "Moldova" },
                                        { code: "MC", name: "Monaco" },
                                        { code: "MN", name: "Mongolia" },
                                        { code: "ME", name: "Montenegro" },
                                        { code: "MA", name: "Morocco" },
                                        { code: "MZ", name: "Mozambique" },
                                        { code: "MM", name: "Myanmar" },
                                        { code: "NA", name: "Namibia" },
                                        { code: "NR", name: "Nauru" },
                                        { code: "NP", name: "Nepal" },
                                        { code: "NL", name: "Netherlands" },
                                        { code: "NZ", name: "New Zealand" },
                                        { code: "NI", name: "Nicaragua" },
                                        { code: "NE", name: "Niger" },
                                        { code: "NG", name: "Nigeria" },
                                        { code: "MK", name: "North Macedonia" },
                                        { code: "NO", name: "Norway" },
                                        { code: "OM", name: "Oman" },
                                        { code: "PK", name: "Pakistan" },
                                        { code: "PW", name: "Palau" },
                                        { code: "PA", name: "Panama" },
                                        { code: "PG", name: "Papua New Guinea" },
                                        { code: "PY", name: "Paraguay" },
                                        { code: "PE", name: "Peru" },
                                        { code: "PH", name: "Philippines" },
                                        { code: "PL", name: "Poland" },
                                        { code: "PT", name: "Portugal" },
                                        { code: "QA", name: "Qatar" },
                                        { code: "RO", name: "Romania" },
                                        { code: "RU", name: "Russian Federation" },
                                        { code: "RW", name: "Rwanda" },
                                        { code: "KN", name: "Saint Kitts and Nevis" },
                                        { code: "LC", name: "Saint Lucia" },
                                        { code: "VC", name: "Saint Vincent and the Grenadines" },
                                        { code: "WS", name: "Samoa" },
                                        { code: "SM", name: "San Marino" },
                                        { code: "ST", name: "Sao Tome and Principe" },
                                        { code: "SA", name: "Saudi Arabia" },
                                        { code: "SN", name: "Senegal" },
                                        { code: "RS", name: "Serbia" },
                                        { code: "SC", name: "Seychelles" },
                                        { code: "SL", name: "Sierra Leone" },
                                        { code: "SG", name: "Singapore" },
                                        { code: "SK", name: "Slovakia" },
                                        { code: "SI", name: "Slovenia" },
                                        { code: "SB", name: "Solomon Islands" },
                                        { code: "SO", name: "Somalia" },
                                        { code: "ZA", name: "South Africa" },
                                        { code: "SS", name: "South Sudan" },
                                        { code: "ES", name: "Spain" },
                                        { code: "LK", name: "Sri Lanka" },
                                        { code: "SD", name: "Sudan" },
                                        { code: "SR", name: "Suriname" },
                                        { code: "SE", name: "Sweden" },
                                        { code: "CH", name: "Switzerland" },
                                        { code: "SY", name: "Syrian Arab Republic" },
                                        { code: "TJ", name: "Tajikistan" },
                                        { code: "TZ", name: "Tanzania" },
                                        { code: "TH", name: "Thailand" },
                                        { code: "TL", name: "Timor-Leste" },
                                        { code: "TG", name: "Togo" },
                                        { code: "TO", name: "Tonga" },
                                        { code: "TT", name: "Trinidad and Tobago" },
                                        { code: "TN", name: "Tunisia" },
                                        { code: "TR", name: "Türkiye" },
                                        { code: "TM", name: "Turkmenistan" },
                                        { code: "TV", name: "Tuvalu" },
                                        { code: "UG", name: "Uganda" },
                                        { code: "UA", name: "Ukraine" },
                                        { code: "AE", name: "United Arab Emirates" },
                                        { code: "GB", name: "United Kingdom" },
                                        { code: "US", name: "United States of America" },
                                        { code: "UY", name: "Uruguay" },
                                        { code: "UZ", name: "Uzbekistan" },
                                        { code: "VU", name: "Vanuatu" },
                                        { code: "VE", name: "Venezuela" },
                                        { code: "VN", name: "Viet Nam" },
                                        { code: "YE", name: "Yemen" },
                                        { code: "ZM", name: "Zambia" },
                                        { code: "ZW", name: "Zimbabwe" }
                                    ];

                                    // Sort countries alphabetically by name
                                    unCountries.sort((a, b) => a.name.localeCompare(b.name));

                                    // Get the select element
                                    const selectElement = document.getElementById('location-country');

                                    // Populate the select element with country options
                                    unCountries.forEach(country => {
                                        const option = document.createElement('option');
                                        option.value = country.code;
                                        option.textContent = country.name;
                                        selectElement.appendChild(option);
                                    });
                                </script>
                                <!-- <input type="text" id="location-country" placeholder="Country"> -->
                            </div>
                        </div>
                        <div class="stat-label">Location</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="campaign-goal">$0</div>
                        <div id="goal-edit" class="edit-mode" style="display: none;">
                            <div class="form-group">
                                <label for="goal-amount">Goal Amount</label>
                                <input type="number" id="goal-amount" placeholder="0" min="0" step="1">
                            </div>
                            <div class="form-group">
                                <label for="goal-currency">Currency</label>
                                <select id="goal-currency">
                                    <option value="USD">USD</option>
                                    <option value="EUR">EUR</option>
                                    <option value="GBP">GBP</option>
                                    <option value="XLM">XLM</option>
                                </select>
                            </div>
                        </div>
                        <div class="stat-label">Goal Amount</div>
                    </div>
                </div>
            </div>
            <div id="map"></div>
            <div id="coordinates-edit" class="edit-mode" style="display: none;">
                <div class="form-row">
                    <div class="form-group">
                        <label for="lat-input">Latitude</label>
                        <input type="number" id="lat-input" step="0.000001" placeholder="0.000000">
                    </div>
                    <div class="form-group">
                        <label for="lng-input">Longitude</label>
                        <input type="number" id="lng-input" step="0.000001" placeholder="0.000000">
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="progress-container">
                <div class="progress-stats">
                    <span>Progress</span>
                    <span id="campaign-raised">$0</span>
                    <div id="raised-edit" class="edit-mode" style="display: none;">
                        <input type="number" id="raised-amount" placeholder="0" min="0" step="1">
                    </div>
                </div>
                <div class="progress-bar">
                    <div id="progress-bar-fill"></div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2 class="section-title">
                Impact Metrics
                <div class="section-title-actions">
                    <button id="add-metric-btn" class="btn btn-primary btn-icon" style="display: none;"><i class="fas fa-plus"></i></button>
                </div>
            </h2>
            <ul id="impact-metrics" class="impact-metrics"></ul>
        </div>

        <div class="card">
            <h2 class="section-title">
                Milestones
                <div class="section-title-actions">
                    <button id="add-milestone-btn" class="btn btn-primary btn-icon" style="display: none;"><i class="fas fa-plus"></i></button>
                </div>
            </h2>
            <ul id="milestones" class="milestones"></ul>
        </div>

        <div class="card">
            <h2 class="section-title">
                Media Gallery
                <div class="section-title-actions">
                    <button id="add-media-btn" class="btn btn-primary btn-icon" style="display: none;"><i class="fas fa-plus"></i></button>
                </div>
            </h2>
            <div id="media-gallery" class="media-gallery"></div>
        </div>
    </div>
</main>

<!-- Notification -->
<div id="notification" class="notification">
    <span id="notification-message"></span>
</div>

<!-- Modals -->
<!-- Add/Edit Metric Modal -->
<div id="metric-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title" id="metric-modal-title">Add Impact Metric</h3>
            <button class="modal-close" onclick="app.closeModal('metric-modal')">&times;</button>
        </div>
        <form id="metric-form">
            <input type="hidden" id="metric-id">
            <div class="form-group">
                <label for="metric-name">Metric Name</label>
                <input type="text" id="metric-name" required placeholder="e.g., Water Access Hours">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="metric-baseline">Baseline</label>
                    <input type="number" id="metric-baseline" required placeholder="0" min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label for="metric-current">Current</label>
                    <input type="number" id="metric-current" required placeholder="0" min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label for="metric-target">Target</label>
                    <input type="number" id="metric-target" required placeholder="100" min="0" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <label for="metric-unit">Unit</label>
                <input type="text" id="metric-unit" required placeholder="e.g., hours/day">
            </div>
            <div class="action-buttons">
                <button type="button" class="btn btn-secondary" onclick="app.closeModal('metric-modal')">Cancel</button>
                <button type="submit" class="btn btn-primary">Save Metric</button>
            </div>
        </form>
    </div>
</div>

<!-- Add/Edit Milestone Modal -->
<div id="milestone-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title" id="milestone-modal-title">Add Milestone</h3>
            <button class="modal-close" onclick="app.closeModal('milestone-modal')">&times;</button>
        </div>
        <form id="milestone-form">
            <input type="hidden" id="milestone-id">
            <div class="form-group">
                <label for="milestone-title">Title</label>
                <input type="text" id="milestone-title" required placeholder="e.g., Dig Well">
            </div>
            <div class="form-group">
                <label for="milestone-description">Description</label>
                <textarea id="milestone-description" required placeholder="Milestone description"></textarea>
            </div>
            <div class="form-group">
                <label for="milestone-status">Status</label>
                <select id="milestone-status" required>
                    <option value="pending">Pending</option>
                    <option value="active">Active</option>
                    <option value="completed">Completed</option>
                </select>
            </div>
            <div class="action-buttons">
                <button type="button" class="btn btn-secondary" onclick="app.closeModal('milestone-modal')">Cancel</button>
                <button type="submit" class="btn btn-primary">Save Milestone</button>
            </div>
        </form>
    </div>
</div>

<!-- Add/Edit Media Modal -->
<div id="media-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title" id="media-modal-title">Add Media</h3>
            <button class="modal-close" onclick="app.closeModal('media-modal')">&times;</button>
        </div>
        <form id="media-form">
            <input type="hidden" id="media-id">
            <div class="form-group">
                <label for="media-type">Media Type</label>
                <select id="media-type" required>
                    <option value="image">Image</option>
                    <option value="document">Document</option>
                </select>
            </div>
            <div class="form-group">
                <label for="media-url">URL</label>
                <input type="url" id="media-url" required placeholder="https://example.com/image.jpg">
            </div>
            <div class="form-group">
                <label for="media-caption">Caption</label>
                <input type="text" id="media-caption" required placeholder="Media caption">
            </div>
            <div class="action-buttons">
                <button type="button" class="btn btn-secondary" onclick="app.closeModal('media-modal')">Cancel</button>
                <button type="submit" class="btn btn-primary">Save Media</button>
            </div>
        </form>
    </div>
</div>

<!-- Preview Modal -->
<div id="preview-modal" class="modal">
    <div class="modal-content" style="max-width: 90%; width: 1200px;">
        <div class="modal-header">
            <h3 class="modal-title">Campaign Preview</h3>
            <button class="modal-close" onclick="app.closeModal('preview-modal')">&times;</button>
        </div>
        <div class="preview-devices">
            <button class="preview-device-btn active" data-device="desktop" onclick="app.changePreviewDevice('desktop')">
                <i class="fas fa-desktop"></i> Desktop
            </button>
            <button class="preview-device-btn" data-device="tablet" onclick="app.changePreviewDevice('tablet')">
                <i class="fas fa-tablet-alt"></i> Tablet
            </button>
            <button class="preview-device-btn" data-device="mobile" onclick="app.changePreviewDevice('mobile')">
                <i class="fas fa-mobile-alt"></i> Mobile
            </button>
        </div>
        <div id="preview-container" style="width: 100%; overflow: hidden; border-radius: 8px; transition: all 0.3s ease;">
            <iframe id="preview-frame" class="preview-frame" src=""></iframe>
        </div>
    </div>
</div>

<!-- SEO Modal -->
<div id="seo-modal" class="modal">
    <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header">
            <h3 class="modal-title">SEO & Social Media Preview</h3>
            <button class="modal-close" onclick="app.closeModal('seo-modal')">&times;</button>
        </div>
        
        <div class="tab-buttons">
            <button class="tab-button active" data-tab="seo-settings" onclick="app.changeTab('seo-settings')">SEO Settings</button>
            <button class="tab-button" data-tab="previews" onclick="app.changeTab('previews')">Previews</button>
        </div>
        
        <!-- SEO Settings Tab -->
        <div class="tab-content active" id="seo-settings">
            <div class="seo-form-group">
                <label for="seo-title">SEO Title (60-70 characters)</label>
                <input type="text" id="seo-title" maxlength="70" placeholder="Help Bring Clean Water to Rural Kenya - GiveHub Campaign">
                <div style="display: flex; justify-content: flex-end; font-size: 0.75rem; color: #6b7280; margin-top: 4px;">
                    <span id="seo-title-counter">0</span>/70
                </div>
            </div>
            
            <div class="seo-form-group">
                <label for="seo-description">Meta Description (150-160 characters)</label>
                <textarea id="seo-description" maxlength="160" placeholder="Join our mission to provide clean water to communities in rural Kenya. Every donation helps us build sustainable water systems and improve lives."></textarea>
                <div style="display: flex; justify-content: flex-end; font-size: 0.75rem; color: #6b7280; margin-top: 4px;">
                    <span id="seo-description-counter">0</span>/160
                </div>
            </div>
            
            <div class="seo-form-group">
                <label for="social-title">Social Media Title (may differ from SEO title)</label>
                <input type="text" id="social-title" placeholder="Help Us Bring Clean Water to Communities in Need">
            </div>
            
            <div class="seo-form-group">
                <label for="social-description">Social Media Description</label>
                <textarea id="social-description" placeholder="Every $50 provides clean water access for one person. Join our mission to transform communities in rural Kenya through sustainable water solutions."></textarea>
            </div>
            
            <div class="seo-form-group">
                <label for="social-image">Social Media Image URL</label>
                <input type="url" id="social-image" placeholder="https://example.com/campaign-image.jpg">
                <p style="font-size: 0.75rem; color: #6b7280; margin-top: 4px;">
                    Recommended size: 1200×630 pixels for Facebook, 1024×512 pixels for Twitter
                </p>
            </div>
            
            <div class="action-buttons">
                <button type="button" class="btn btn-primary" onclick="app.saveSeoSettings()">
                    <i class="fas fa-save"></i> Save SEO Settings
                </button>
                <button type="button" class="btn btn-secondary" onclick="app.applySeoFromCampaign()">
                    <i class="fas fa-sync"></i> Auto-generate from Campaign
                </button>
            </div>
        </div>
        
        <!-- Previews Tab -->
        <div class="tab-content" id="previews">
            <h4 style="margin-bottom: 12px;">Google Search Result Preview</h4>
            <div class="seo-preview-card">
                <div class="seo-preview-google">
                    <div class="seo-preview-title" id="preview-google-title">Campaign Title - The Give Hub</div>
                    <div class="seo-preview-url" id="preview-google-url">https://thegivehub.com/campaign/clean-water-kenya</div>
                    <div class="seo-preview-description" id="preview-google-description">Join our mission to provide clean water to communities in rural Kenya. Every donation helps us build sustainable water systems and improve lives.</div>
                </div>
            </div>
            
            <h4 style="margin: 16px 0 12px;">Facebook Preview</h4>
            <div class="seo-preview-card">
                <div class="seo-preview-facebook">
                    <div class="seo-preview-image" id="preview-facebook-image">
                        <span>Campaign Image</span>
                    </div>
                    <div class="seo-preview-facebook-content">
                        <div class="seo-preview-facebook-title" id="preview-facebook-title">Help Us Bring Clean Water to Communities in Need</div>
                        <div class="seo-preview-facebook-description" id="preview-facebook-description">Every $50 provides clean water access for one person. Join our mission to transform communities in rural Kenya through sustainable water solutions.</div>
                        <div class="seo-preview-facebook-url" id="preview-facebook-url">THEGIVEHUB.COM</div>
                    </div>
                </div>
            </div>
            
            <h4 style="margin: 16px 0 12px;">Twitter Preview</h4>
            <div class="seo-preview-card">
                <div class="seo-preview-twitter">
                    <div class="seo-preview-twitter-card">
                        <div class="seo-preview-image" id="preview-twitter-image" style="height: 200px;">
                            <span>Campaign Image</span>
                        </div>
                        <div class="seo-preview-facebook-content">
                            <div class="seo-preview-facebook-title" id="preview-twitter-title">Help Us Bring Clean Water to Communities in Need</div>
                            <div class="seo-preview-facebook-url" id="preview-twitter-url">THEGIVEHUB.COM</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Share Modal -->
<div id="share-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title" id="share-modal-title">Share on Facebook</h3>
            <button class="modal-close" onclick="app.closeModal('share-modal')">&times;</button>
        </div>
        
        <div id="share-content-facebook" class="share-content">
            <div class="seo-preview-card" style="margin-bottom: 16px;">
                <div class="seo-preview-facebook">
                    <div class="seo-preview-image" id="share-facebook-image">
                        <span>Campaign Image</span>
                    </div>
                    <div class="seo-preview-facebook-content">
                        <div class="seo-preview-facebook-title" id="share-facebook-title">Help Us Bring Clean Water to Communities in Need</div>
                        <div class="seo-preview-facebook-description" id="share-facebook-description">Every $50 provides clean water access for one person. Join our mission to transform communities in rural Kenya through sustainable water solutions.</div>
                        <div class="seo-preview-facebook-url" id="share-facebook-url">THEGIVEHUB.COM</div>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="facebook-message">Add a message (optional)</label>
                <textarea id="facebook-message" placeholder="I'm supporting this important cause. Will you join me?"></textarea>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="app.shareToPlatform('facebook')">
                    <i class="fab fa-facebook"></i> Share on Facebook
                </button>
            </div>
        </div>
        
        <div id="share-content-twitter" class="share-content" style="display: none;">
            <div class="seo-preview-card" style="margin-bottom: 16px;">
                <div class="seo-preview-twitter">
                    <div class="seo-preview-twitter-card">
                        <div class="seo-preview-image" id="share-twitter-image" style="height: 200px;">
                            <span>Campaign Image</span>
                        </div>
                        <div class="seo-preview-facebook-content">
                            <div class="seo-preview-facebook-title" id="share-twitter-title">Help Us Bring Clean Water to Communities in Need</div>
                            <div class="seo-preview-facebook-url" id="share-twitter-url">THEGIVEHUB.COM</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="twitter-message">Tweet (280 characters max)</label>
                <textarea id="twitter-message" maxlength="280" placeholder="Join me in supporting this clean water project in Kenya through @GiveHub! Every donation makes a difference."></textarea>
                <div style="display: flex; justify-content: flex-end; font-size: 0.75rem; color: #6b7280; margin-top: 4px;">
                    <span id="twitter-message-counter">0</span>/280
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="app.shareToPlatform('twitter')">
                    <i class="fab fa-twitter"></i> Share on Twitter
                </button>
            </div>
        </div>
        
        <div id="share-content-linkedin" class="share-content" style="display: none;">
            <div class="form-group">
                <label for="linkedin-title">Title</label>
                <input type="text" id="linkedin-title" value="Help Us Bring Clean Water to Communities in Need">
            </div>
            
            <div class="form-group">
                <label for="linkedin-message">Message</label>
                <textarea id="linkedin-message" placeholder="I'm supporting this meaningful clean water project through The Give Hub. Join me in making a difference for communities in need."></textarea>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="app.shareToPlatform('linkedin')">
                    <i class="fab fa-linkedin"></i> Share on LinkedIn
                </button>
            </div>
        </div>
        
        <div id="share-content-email" class="share-content" style="display: none;">
            <div class="form-group">
                <label for="email-subject">Email Subject</label>
                <input type="text" id="email-subject" value="Join me in supporting this important clean water project">
            </div>
            
            <div class="form-group">
                <label for="email-body">Email Body</label>
                <textarea id="email-body" rows="6">
Hello,

I wanted to share this Clean Water Campaign with you from The Give Hub. They're working to provide sustainable water solutions to communities in rural Kenya.

You can learn more and donate here: {{campaign_url}}

Every contribution helps make a real difference in people's lives.

Thanks for considering,
[Your Name]
                </textarea>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="app.shareToPlatform('email')">
                    <i class="fas fa-envelope"></i> Compose Email
                </button>
            </div>
        </div>
        
        <div id="share-content-link" class="share-content" style="display: none;">
            <div class="form-group">
                <label for="campaign-url">Campaign URL</label>
                <div class="url-input-group">
                    <input type="text" id="campaign-url" value="https://thegivehub.com/campaign/clean-water-kenya" readonly>
                    <button id="copy-url-btn" onclick="app.copyToClipboard('campaign-url')">
                        <i class="fas fa-copy"></i>
                    </button>
                </div>
            </div>
            
            <div class="form-group">
                <label>Share on other platforms</label>
                <div class="share-options">
                    <div class="share-option" onclick="app.openShareModal('facebook')">
                        <i class="fab fa-facebook"></i> Facebook
                    </div>
                    <div class="share-option" onclick="app.openShareModal('twitter')">
                        <i class="fab fa-twitter"></i> Twitter
                    </div>
                    <div class="share-option" onclick="app.openShareModal('linkedin')">
                        <i class="fab fa-linkedin"></i> LinkedIn
                    </div>
                    <div class="share-option" onclick="app.openShareModal('email')">
                        <i class="fas fa-envelope"></i> Email
                    </div>
                    <div class="share-option" onclick="app.openShareModal('whatsapp')">
                        <i class="fab fa-whatsapp"></i> WhatsApp
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
(function() {
    const $ = str => document.querySelector(str);
    const $$ = str => document.querySelectorAll(str);

    const app = {
        data: {},
        state: {
            loaded: false,
            map: null,
            editMode: false,
            editingItem: null,
            marker: null,
            currentPreviewDevice: 'desktop',
            currentTab: 'seo-settings',
            seoSettings: {
                title: '',
                description: '',
                socialTitle: '',
                socialDescription: '',
                socialImage: ''
            }
        },

        init() {
            this.bindEvents();
            const query = this.utils.parseSearch();
            const campaignId = query.id;
            const app=this;
            this.fetch(`/api/campaign?id=${campaignId}`, {
                method: 'GET',
                headers: {
                    "Authorization": `Bearer ${localStorage.getItem('accessToken')}`
                }
            }).then(data => {
                app.data = data;
                app.state.loaded = true;
                app.render();
            }).catch(error => {
                console.error('Error fetching campaign data:', error);
            });
            this.initCharacterCounters();
        },

        bindEvents() {
            // Edit mode buttons
            $('#edit-campaign-btn').addEventListener('click', () => this.toggleEditMode(true));
            $('#save-campaign-btn').addEventListener('click', () => this.saveCampaign(true));
            $('#cancel-edit-btn').addEventListener('click', () => this.toggleEditMode(false));

            // Add item buttons
            $('#add-metric-btn').addEventListener('click', () => this.openMetricModal());
            $('#add-milestone-btn').addEventListener('click', () => this.openMilestoneModal());
            $('#add-media-btn').addEventListener('click', () => this.openMediaModal());

            // Form submissions
            $('#metric-form').addEventListener('submit', (e) => {
                e.preventDefault();
                this.saveMetric();
            });

            $('#milestone-form').addEventListener('submit', (e) => {
                e.preventDefault();
                this.saveMilestone();
            });

            $('#media-form').addEventListener('submit', (e) => {
                e.preventDefault();
                this.saveMedia();
            });

            // Map click for coordinate editing in edit mode
            $('#map').addEventListener('click', (e) => {
                if (this.state.editMode && this.state.map) {
                    this.handleMapClick(e);
                }
            });

            // Character counters for SEO fields
            $('#seo-title').addEventListener('input', () => this.updateCharacterCount('seo-title'));
            $('#seo-description').addEventListener('input', () => this.updateCharacterCount('seo-description'));
            $('#twitter-message').addEventListener('input', () => this.updateCharacterCount('twitter-message'));

            // Update SEO previews on input
            $$('#seo-title, #seo-description, #social-title, #social-description, #social-image').forEach(el => {
                el.addEventListener('input', () => this.updateSeoPreviews());
            });
        },

        initCharacterCounters() {
            this.updateCharacterCount('seo-title');
            this.updateCharacterCount('seo-description');
            this.updateCharacterCount('twitter-message');
        },

        updateCharacterCount(elementId) {
            const element = $('#' + elementId);
            const counter = $('#' + elementId + '-counter');
            if (element && counter) {
                counter.textContent = element.value.length;
            }
        },

        utils: {
            parseSearch() {
                const qs = document.location.search.replace(/^\?/, '');
                const items = qs.split(/&/);
                const query = {};
                for (let item of items) {
                    const parts = item.split(/=/, 2);
                    if (parts && parts[0]) query[parts[0]] = decodeURIComponent(parts[1] || '');
                }
                return query;
            },

            formatCurrency(amount, currency = 'USD') {
                return new Intl.NumberFormat('en-US', {
                    style: 'currency',
                    currency: currency
                }).format(amount);
            },

            getStatusClass(status) {
                const statusMap = {
                    'active': 'status-active',
                    'completed': 'status-completed',
                    'pending': 'status-pending'
                };
                return statusMap[status.toLowerCase()] || 'status-pending';
            },

            showNotification(message, type = 'success') {
                const notification = $('#notification');
                $('#notification-message').textContent = message;

                notification.className = 'notification';
                notification.classList.add(type);
                notification.classList.add('show');

                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            },

            generateId() {
                return 'temp_' + Date.now() + '_' + Math.floor(Math.random() * 1000);
            },

            truncateText(text, maxLength) {
                if (!text || text.length <= maxLength) return text;
                return text.substring(0, maxLength - 3) + '...';
            },

            getDomainFromUrl(url) {
                try {
                    const domain = new URL(url).hostname.toUpperCase();
                    return domain;
                } catch (e) {
                    return 'THEGIVEHUB.COM';
                }
            },

            getSlugFromTitle(title) {
                if (!title) return 'campaign';
                return title
                    .toLowerCase()
                    .replace(/[^\w\s-]/g, '')  // Remove special characters
                    .replace(/\s+/g, '-')      // Replace spaces with dashes
                    .replace(/-+/g, '-')       // Remove consecutive dashes
                    .substring(0, 50);         // Limit length
            }
        },

        fetch(url) {
            const app=this;
            fetch(url, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('accessToken')}`
                }
            })
            .then(response => response.json())
            .then(data => {
                app.data = data;
                app.state.loaded = true;
                app.render();

                // Initialize SEO data from campaign data
                app.initSeoFromCampaign();
            })
            .catch(error => {
                console.error('Fetch error:', error);
                app.utils.showNotification('Failed to load campaign data', 'error');
            });
        },

        toggleEditMode(isEditing) {
            this.state.editMode = isEditing;

            // Toggle edit buttons
            $('#edit-campaign-btn').style.display = isEditing ? 'none' : 'block';
            $('#save-campaign-btn').style.display = isEditing ? 'block' : 'none';
            $('#cancel-edit-btn').style.display = isEditing ? 'block' : 'none';

            // Toggle add buttons
            $('#add-metric-btn').style.display = isEditing ? 'block' : 'none';
            $('#add-milestone-btn').style.display = isEditing ? 'block' : 'none';
            $('#add-media-btn').style.display = isEditing ? 'block' : 'none';

            // Toggle display/edit fields
            $('#campaign-title').style.display = isEditing ? 'none' : 'block';
            $('#campaign-title-edit').style.display = isEditing ? 'block' : 'none';

            $('#campaign-description').style.display = isEditing ? 'none' : 'block';
            $('#campaign-description-edit').style.display = isEditing ? 'block' : 'none';

            $('#campaign-location').style.display = isEditing ? 'none' : 'block';
            $('#location-edit').style.display = isEditing ? 'block' : 'none';

            $('#campaign-goal').style.display = isEditing ? 'none' : 'block';
            $('#goal-edit').style.display = isEditing ? 'block' : 'none';

            $('#coordinates-edit').style.display = isEditing ? 'block' : 'none';

            $('#campaign-raised').style.display = isEditing ? 'none' : 'block';
            $('#raised-edit').style.display = isEditing ? 'block' : 'none';

            // Show/hide edit buttons on items
            const itemActions = $$('.item-actions');
            if (itemActions) {
                itemActions.forEach(el => {
                    el.style.display = isEditing ? 'flex' : 'none';
                });
            }

            if (isEditing) {
                // Populate edit fields with current values
                $('#title-input').value = this.data.title || '';
                $('#description-input').value = this.data.description || '';
                $('#location-region').value = this.data.location?.region || '';
                $('#location-country').value = this.data.location?.country || '';
                $('#goal-amount').value = this.data.funding?.goalAmount || 0;
                $('#goal-currency').value = this.data.funding?.currency || 'USD';
                $('#raised-amount').value = this.data.funding?.raisedAmount || 0;
                
                if (this.data.location?.coordinates) {
                    $('#lat-input').value = this.data.location.coordinates.latitude || 0;
                    $('#lng-input').value = this.data.location.coordinates.longitude || 0;
                }
            } else {
                // If canceling, revert to original data
                this.render();
            }
        },
        
        render() {
            const data = this.data;
            
            // Basic Info
            $('#campaign-title').textContent = data.title || "Campaign Title";
            $('#campaign-description').textContent = data.description || "Campaign Description";
            $('#campaign-location').textContent = data.location?.region ? `${data.location.region}, ${data.location.country}` : "Unknown";
            $('#campaign-goal').textContent = this.utils.formatCurrency(data.funding?.goalAmount || 0, data.funding?.currency || 'USD');
            $('#campaign-raised').textContent = this.utils.formatCurrency(data.funding?.raisedAmount || 0, data.funding?.currency || 'USD');
            $('#campaign-donors').textContent = new Intl.NumberFormat().format(data.funding?.donorCount || 0);

            // Map
            if (data.location?.coordinates) {
                this.renderMap(data.location.coordinates.latitude, 
                            data.location.coordinates.longitude, 
                            `${data.location.region}, ${data.location.country}`);
            }

            // Progress Bar
            const progress = data.funding ? (data.funding.raisedAmount / data.funding.goalAmount) * 100 : 0;
            $('#progress-bar-fill').style.width = `${progress}%`;

            // Impact Metrics
            this.renderImpactMetrics();

            // Milestones
            this.renderMilestones();

            // Media Gallery
            this.renderMediaGallery();
        },
        
        renderImpactMetrics() {
            const metricsContainer = $('#impact-metrics');
            metricsContainer.innerHTML = '';
            
            if (!this.data.impact || !this.data.impact.metrics || !this.data.impact.metrics.length) {
                metricsContainer.innerHTML = '<li>No impact metrics defined</li>';
                return;
            }
            
            this.data.impact.metrics.forEach((metric, index) => {
                const li = document.createElement('li');
                
                const itemContent = document.createElement('div');
                itemContent.className = 'item-content';
                
                const strongName = document.createElement('strong');
                strongName.textContent = metric.name;
                
                const spanValue = document.createElement('span');
                spanValue.textContent = `${metric.current}/${metric.target} ${metric.unit}`;
                
                const divBaseline = document.createElement('div');
                divBaseline.className = 'text-sm text-gray-600';
                divBaseline.textContent = `Baseline: ${metric.baseline} ${metric.unit}`;
                
                itemContent.appendChild(strongName);
                itemContent.appendChild(document.createTextNode(' '));
                itemContent.appendChild(spanValue);
                itemContent.appendChild(divBaseline);
                
                const itemActions = document.createElement('div');
                itemActions.className = 'item-actions';
                
                const editBtn = document.createElement('button');
                editBtn.className = 'btn btn-secondary btn-icon';
                editBtn.innerHTML = '<i class="fas fa-edit"></i>';
                editBtn.addEventListener('click', () => this.openMetricModal(index));
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn btn-danger btn-icon';
                deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
                deleteBtn.addEventListener('click', () => this.deleteItem('metric', index));
                
                itemActions.appendChild(editBtn);
                itemActions.appendChild(deleteBtn);
                
                li.appendChild(itemContent);
                li.appendChild(itemActions);
                
                // Hide actions if not in edit mode
                if (!this.state.editMode) {
                    itemActions.style.display = 'none';
                }
                
                metricsContainer.appendChild(li);
            });
        },
        
        renderMilestones() {
            const milestonesContainer = $('#milestones');
            milestonesContainer.innerHTML = '';
            
            if (!this.data.timeline || !this.data.timeline.milestones || !this.data.timeline.milestones.length) {
                milestonesContainer.innerHTML = '<li>No milestones defined</li>';
                return;
            }
            
            this.data.timeline.milestones.forEach((milestone, index) => {
                const li = document.createElement('li');
                
                const itemContent = document.createElement('div');
                itemContent.className = 'item-content';
                
                const titleRow = document.createElement('div');
                titleRow.style.display = 'flex';
                titleRow.style.justifyContent = 'space-between';
                
                const strongTitle = document.createElement('strong');
                strongTitle.textContent = milestone.title;
                
                const statusBadge = document.createElement('span');
                statusBadge.className = `status-badge ${this.utils.getStatusClass(milestone.status)}`;
                statusBadge.textContent = milestone.status;
                
                titleRow.appendChild(strongTitle);
                titleRow.appendChild(statusBadge);
                
                const description = document.createElement('p');
                description.className = 'text-gray-600 mt-2';
                description.textContent = milestone.description;
                
                itemContent.appendChild(titleRow);
                itemContent.appendChild(description);
                
                const itemActions = document.createElement('div');
                itemActions.className = 'item-actions';
                
                const editBtn = document.createElement('button');
                editBtn.className = 'btn btn-secondary btn-icon';
                editBtn.innerHTML = '<i class="fas fa-edit"></i>';
                editBtn.addEventListener('click', () => this.openMilestoneModal(index));
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn btn-danger btn-icon';
                deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
                deleteBtn.addEventListener('click', () => this.deleteItem('milestone', index));
                
                itemActions.appendChild(editBtn);
                itemActions.appendChild(deleteBtn);
                
                li.appendChild(itemContent);
                li.appendChild(itemActions);
                
                // Hide actions if not in edit mode
                if (!this.state.editMode) {
                    itemActions.style.display = 'none';
                }
                
                milestonesContainer.appendChild(li);
            });
        },
        
        renderMediaGallery() {
            const mediaGallery = $('#media-gallery');
            mediaGallery.innerHTML = '';
            
            if (!this.data.media || !this.data.media.length) {
                mediaGallery.innerHTML = '<div>No media items available</div>';
                return;
            }
            
            this.data.media.forEach((media, index) => {
                const mediaItem = document.createElement('div');
                mediaItem.className = 'media-item';
                
                if (media.type === 'image') {
                    const img = document.createElement('img');
                    img.src = media.url;
                    img.alt = media.caption;
                    
                    const caption = document.createElement('div');
                    caption.className = 'media-caption';
                    caption.textContent = media.caption;
                    
                    mediaItem.appendChild(img);
                    mediaItem.appendChild(caption);
                } else {
                    const link = document.createElement('a');
                    link.href = media.url;
                    link.target = '_blank';
                    link.className = 'flex items-center justify-center h-full';
                    
                    const icon = document.createElement('i');
                    icon.className = 'fas fa-file-alt fa-2x';
                    
                    const caption = document.createElement('div');
                    caption.className = 'media-caption';
                    caption.textContent = media.caption;
                    
                    link.appendChild(icon);
                    link.appendChild(caption);
                    mediaItem.appendChild(link);
                }
                
                // Add edit controls
                if (this.state.editMode) {
                    const controls = document.createElement('div');
                    controls.className = 'item-actions';
                    controls.style.position = 'absolute';
                    controls.style.top = '5px';
                    controls.style.right = '5px';
                    controls.style.display = 'flex';
                    controls.style.gap = '5px';
                    
                    const editBtn = document.createElement('button');
                    editBtn.className = 'btn btn-secondary btn-icon';
                    editBtn.innerHTML = '<i class="fas fa-edit"></i>';
                    editBtn.addEventListener('click', () => this.openMediaModal(index));
                    
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'btn btn-danger btn-icon';
                    deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
                    deleteBtn.addEventListener('click', () => this.deleteItem('media', index));
                    
                    controls.appendChild(editBtn);
                    controls.appendChild(deleteBtn);
                    mediaItem.appendChild(controls);
                }
                
                mediaGallery.appendChild(mediaItem);
            });
        },
        
        renderMap(lat, lng, popupText) {
            if (this.state.map) {
                this.state.map.remove();
            }
            
            this.state.map = L.map('map').setView([lat, lng], 4);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '© OpenStreetMap contributors'
            }).addTo(this.state.map);
            
            // Create marker at the location
            this.state.marker = L.marker([lat, lng], {
                draggable: this.state.editMode // Make marker draggable in edit mode
            }).addTo(this.state.map)
              .bindPopup(popupText);
            
            // Open popup
            this.state.marker.openPopup();
            
            // Add marker drag end event for edit mode
            if (this.state.editMode) {
                this.state.marker.on('dragend', (event) => {
                    const marker = event.target;
                    const position = marker.getLatLng();
                    $('#lat-input').value = position.lat;
                    $('#lng-input').value = position.lng;
                });
            }
        },
        
        handleMapClick(event) {
            // Get click coordinates
            const containerPoint = this.state.map.mouseEventToContainerPoint(event.originalEvent);
            const latlng = this.state.map.containerPointToLatLng(containerPoint);
            
            // Update marker position
            if (this.state.marker) {
                this.state.marker.setLatLng(latlng);
            } else {
                this.state.marker = L.marker(latlng, {
                    draggable: true
                }).addTo(this.state.map);
            }
            
            // Update form fields
            $('#lat-input').value = latlng.lat;
            $('#lng-input').value = latlng.lng;
        },
        
        // Modal handling methods
        openModal(modalId) {
            $(`#${modalId}`).classList.add('open');
        },
        
        closeModal(modalId) {
            $(`#${modalId}`).classList.remove('open');
        },
        
        openMetricModal(index = null) {
            const modal = $('#metric-modal');
            const title = $('#metric-modal-title');
            const form = $('#metric-form');
            
            // Reset form
            form.reset();
            
            if (index !== null) {
                // Edit existing metric
                title.textContent = 'Edit Impact Metric';
                const metric = this.data.impact.metrics[index];
                
                $('#metric-id').value = index;
                $('#metric-name').value = metric.name;
                $('#metric-baseline').value = metric.baseline;
                $('#metric-current').value = metric.current;
                $('#metric-target').value = metric.target;
                $('#metric-unit').value = metric.unit;
            } else {
                // Add new metric
                title.textContent = 'Add Impact Metric';
                $('#metric-id').value = '';
            }
            
            this.openModal('metric-modal');
        },
        
        openMilestoneModal(index = null) {
            const modal = $('#milestone-modal');
            const title = $('#milestone-modal-title');
            const form = $('#milestone-form');
            
            // Reset form
            form.reset();
            
            if (index !== null) {
                // Edit existing milestone
                title.textContent = 'Edit Milestone';
                const milestone = this.data.timeline.milestones[index];
                
                $('#milestone-id').value = index;
                $('#milestone-title').value = milestone.title;
                $('#milestone-description').value = milestone.description;
                $('#milestone-status').value = milestone.status;
            } else {
                // Add new milestone
                title.textContent = 'Add Milestone';
                $('#milestone-id').value = '';
            }
            
            this.openModal('milestone-modal');
        },
        
        openMediaModal(index = null) {
            const modal = $('#media-modal');
            const title = $('#media-modal-title');
            const form = $('#media-form');
            
            // Reset form
            form.reset();
            
            if (index !== null) {
                // Edit existing media
                title.textContent = 'Edit Media';
                const media = this.data.media[index];
                
                $('#media-id').value = index;
                $('#media-type').value = media.type;
                $('#media-url').value = media.url;
                $('#media-caption').value = media.caption;
            } else {
                // Add new media
                title.textContent = 'Add Media';
                $('#media-id').value = '';
            }
            
            this.openModal('media-modal');
        },
        
        saveMetric() {
            const id = $('#metric-id').value;
            const newMetric = {
                name: $('#metric-name').value,
                baseline: parseFloat($('#metric-baseline').value),
                current: parseFloat($('#metric-current').value),
                target: parseFloat($('#metric-target').value),
                unit: $('#metric-unit').value
            };
            
            // Ensure impact structure exists
            if (!this.data.impact) {
                this.data.impact = { metrics: [] };
            } else if (!this.data.impact.metrics) {
                this.data.impact.metrics = [];
            }
            
            if (id === '') {
                // Add new metric
                this.data.impact.metrics.push(newMetric);
            } else {
                // Update existing metric
                this.data.impact.metrics[parseInt(id)] = newMetric;
            }
            
            // Update UI
            this.renderImpactMetrics();
            this.closeModal('metric-modal');
            this.utils.showNotification('Metric saved successfully');
            // Persist changes to the server without leaving the page
            this.saveCampaign(false);
        },

        saveMilestone() {
            const id = $('#milestone-id').value;
            const newMilestone = {
                title: $('#milestone-title').value,
                description: $('#milestone-description').value,
                status: $('#milestone-status').value
            };
            
            // Ensure timeline structure exists
            if (!this.data.timeline) {
                this.data.timeline = { milestones: [] };
            } else if (!this.data.timeline.milestones) {
                this.data.timeline.milestones = [];
            }
            
            if (id === '') {
                // Add new milestone
                this.data.timeline.milestones.push(newMilestone);
            } else {
                // Update existing milestone
                this.data.timeline.milestones[parseInt(id)] = newMilestone;
            }
            
            // Update UI
            this.renderMilestones();
            this.closeModal('milestone-modal');
            this.utils.showNotification('Milestone saved successfully');
            // Persist changes to the server without leaving the page
            this.saveCampaign(false);
        },
        
        saveMedia() {
            const id = $('#media-id').value;
            const newMedia = {
                type: $('#media-type').value,
                url: $('#media-url').value,
                caption: $('#media-caption').value
            };
            
            // Ensure media array exists
            if (!this.data.media) {
                this.data.media = [];
            }
            
            if (id === '') {
                // Add new media item
                this.data.media.push(newMedia);
            } else {
                // Update existing media item
                this.data.media[parseInt(id)] = newMedia;
            }
            
            // Update UI
            this.renderMediaGallery();
            this.closeModal('media-modal');
            this.utils.showNotification('Media item saved successfully');
            // Persist media changes without leaving the editor
            this.saveCampaign(false);
        },
        
        deleteItem(type, index) {
            if (!confirm(`Are you sure you want to delete this ${type}?`)) {
                return;
            }
            
            switch (type) {
                case 'metric':
                    this.data.impact.metrics.splice(index, 1);
                    this.renderImpactMetrics();
                    break;
                case 'milestone':
                    this.data.timeline.milestones.splice(index, 1);
                    this.renderMilestones();
                    break;
                case 'media':
                    this.data.media.splice(index, 1);
                    this.renderMediaGallery();
                    break;
            }

            this.utils.showNotification(`${type.charAt(0).toUpperCase() + type.slice(1)} deleted successfully`);
            // Persist deletion immediately
            this.saveCampaign(false);
        },
        
        async saveCampaign(redirect = true) {
            // Collect form data
            console.log(this.data);
            const updatedCampaign = {
                ...this.data,
                title: $('#title-input').value,
                description: $('#description-input').value,
                location: {
                    region: $('#location-region').value,
                    country: $('#location-country').value,
                    coordinates: {
                        latitude: parseFloat($('#lat-input').value),
                        longitude: parseFloat($('#lng-input').value)
                    }
                },
                images: this.data.images ?? [],
                funding: {
                    ...this.data.funding,
                    goalAmount: parseFloat($('#goal-amount').value),
                    currency: $('#goal-currency').value,
                    raisedAmount: parseFloat($('#raised-amount').value)
                }
            };

            // _id cannot be modified during update
            delete updatedCampaign._id;

            console.log(updatedCampaign);

            console.log(this.data);
            
            // Send update to server
            const passData = this.data;
            await fetch(`/api/campaign?id=${this.data._id}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('accessToken')}`
                },
                body: JSON.stringify(updatedCampaign)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                console.log(data);
                this.data = data;
                if (redirect) this.toggleEditMode(false);
                this.utils.showNotification('Campaign updated successfully');

                // Update SEO data after campaign update
                if (redirect) this.initSeoFromCampaign();
            })
            .catch(error => {
                console.error('Error updating campaign:', error);
                this.utils.showNotification('Failed to update campaign', 'error');
            }).finally(() => {
                console.log('Campaign updated');
                console.log(passData);
                this.state.loaded = true;
                if (redirect) {
                    location.href='/pages/campaign-detail.html?id=' + passData._id;
                }
            });
        },
        
        // Preview functionality
        openPreviewModal(device = 'desktop') {
            this.state.currentPreviewDevice = device;
            
            // Set the preview URL to the campaign detail page
            const previewUrl = `/pages/campaign-detail.html?id=${this.data._id}&preview=true`;
            $('#preview-frame').src = previewUrl;
            
            // Update device buttons
            $$('.preview-device-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.device === device);
            });
            
            // Adjust frame width based on device
            const previewContainer = $('#preview-container');
            switch (device) {
                case 'mobile':
                    previewContainer.style.width = '375px';
                    break;
                case 'tablet':
                    previewContainer.style.width = '768px';
                    break;
                case 'desktop':
                default:
                    previewContainer.style.width = '100%';
                    break;
            }
            
            this.openModal('preview-modal');
        },
        
        changePreviewDevice(device) {
            this.state.currentPreviewDevice = device;
            
            // Update active button
            $$('.preview-device-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.device === device);
            });
            
            // Adjust frame width based on device
            const previewContainer = $('#preview-container');
            switch (device) {
                case 'mobile':
                    previewContainer.style.width = '375px';
                    break;
                case 'tablet':
                    previewContainer.style.width = '768px';
                    break;
                case 'desktop':
                default:
                    previewContainer.style.width = '100%';
                    break;
            }
        },
        
        // SEO functionality
        initSeoFromCampaign() {
            // Initialize SEO settings from campaign data
            this.state.seoSettings = {
                title: this.data.title ? `${this.data.title} - The Give Hub` : 'Campaign - The Give Hub',
                description: this.data.description || 'Support this campaign on The Give Hub',
                socialTitle: this.data.title || 'Campaign',
                socialDescription: this.data.description || 'Support this campaign on The Give Hub',
                socialImage: this.data.media && this.data.media.length > 0 && this.data.media[0].type === 'image' ? 
                    this.data.media[0].url : ''
            };
            
            // Update SEO input fields
            $('#seo-title').value = this.state.seoSettings.title;
            $('#seo-description').value = this.state.seoSettings.description;
            $('#social-title').value = this.state.seoSettings.socialTitle;
            $('#social-description').value = this.state.seoSettings.socialDescription;
            $('#social-image').value = this.state.seoSettings.socialImage;
            
            // Update character counters
            this.updateCharacterCount('seo-title');
            this.updateCharacterCount('seo-description');
            
            // Update previews
            this.updateSeoPreviews();
        },
        
        applySeoFromCampaign() {
            this.initSeoFromCampaign();
            this.utils.showNotification('SEO settings updated from campaign');
        },
        
        updateSeoPreviews() {
            // Get values from form
            const title = $('#seo-title').value || 'Campaign - The Give Hub';
            const description = $('#seo-description').value || 'Support this campaign on The Give Hub';
            const socialTitle = $('#social-title').value || title;
            const socialDescription = $('#social-description').value || description;
            const socialImage = $('#social-image').value || '';
            
            // Calculate URL and domain
            const campaignSlug = this.utils.getSlugFromTitle(this.data.title || 'campaign');
            const previewUrl = `https://thegivehub.com/campaign/${campaignSlug}`;
            const domain = this.utils.getDomainFromUrl(previewUrl);
            
            // Update Google preview
            $('#preview-google-title').textContent = title;
            $('#preview-google-url').textContent = previewUrl;
            $('#preview-google-description').textContent = description;
            
            // Update Facebook preview
            $('#preview-facebook-title').textContent = socialTitle;
            $('#preview-facebook-description').textContent = socialDescription;
            $('#preview-facebook-url').textContent = domain;
            
            // Update Facebook preview image if provided
            if (socialImage) {
                $('#preview-facebook-image').innerHTML = `<img src="${socialImage}" alt="Preview" style="width: 100%; height: 100%; object-fit: cover;">`;
            } else {
                $('#preview-facebook-image').innerHTML = '<span>Campaign Image</span>';
            }
            
            // Update Twitter preview
            $('#preview-twitter-title').textContent = socialTitle;
            $('#preview-twitter-url').textContent = domain;
            
            // Update Twitter preview image if provided
            if (socialImage) {
                $('#preview-twitter-image').innerHTML = `<img src="${socialImage}" alt="Preview" style="width: 100%; height: 100%; object-fit: cover;">`;
            } else {
                $('#preview-twitter-image').innerHTML = '<span>Campaign Image</span>';
            }
            
            // Update share modal content
            $('#share-facebook-title').textContent = socialTitle;
            $('#share-facebook-description').textContent = socialDescription;
            $('#share-facebook-url').textContent = domain;
            
            if (socialImage) {
                $('#share-facebook-image').innerHTML = `<img src="${socialImage}" alt="Preview" style="width: 100%; height: 100%; object-fit: cover;">`;
            } else {
                $('#share-facebook-image').innerHTML = '<span>Campaign Image</span>';
            }
            
            $('#share-twitter-title').textContent = socialTitle;
            $('#share-twitter-url').textContent = domain;
            
            if (socialImage) {
                $('#share-twitter-image').innerHTML = `<img src="${socialImage}" alt="Preview" style="width: 100%; height: 100%; object-fit: cover;">`;
            } else {
                $('#share-twitter-image').innerHTML = '<span>Campaign Image</span>';
            }
            
            // Update share link
            $('#campaign-url').value = previewUrl;
        },
        
        openSeoModal() {
            // Reset to the settings tab
            this.changeTab('seo-settings');
            
            // Make sure previews are up to date
            this.updateSeoPreviews();
            
            this.openModal('seo-modal');
        },
        
        changeTab(tabId) {
            // Update active tab button
            $$('.tab-button').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.tab === tabId);
            });
            
            // Show selected tab content
            $$('.tab-content').forEach(tab => {
                tab.classList.toggle('active', tab.id === tabId);
            });
            
            this.state.currentTab = tabId;
        },
        
        saveSeoSettings() {
            // Save the current SEO settings from the form
            this.state.seoSettings = {
                title: $('#seo-title').value,
                description: $('#seo-description').value,
                socialTitle: $('#social-title').value,
                socialDescription: $('#social-description').value,
                socialImage: $('#social-image').value
            };
            
            // Update previews
            this.updateSeoPreviews();
            
            // TODO: In a real implementation, we would send this to the server
            this.utils.showNotification('SEO settings saved successfully');
            
            // Close the modal
            this.closeModal('seo-modal');
        },
        
        // Share functionality
        openShareModal(platform) {
            // Update modal title
            const titleMap = {
                'facebook': 'Share on Facebook',
                'twitter': 'Share on Twitter',
                'linkedin': 'Share on LinkedIn',
                'email': 'Share via Email',
                'link': 'Share Campaign Link',
                'whatsapp': 'Share on WhatsApp'
            };
            
            $('#share-modal-title').textContent = titleMap[platform] || 'Share Campaign';
            
            // Hide all share content sections
            $$('.share-content').forEach(content => {
                content.style.display = 'none';
            });
            
            // Show the selected platform content
            $(`#share-content-${platform}`).style.display = 'block';
            
            // If it's WhatsApp, we'll just redirect
            if (platform === 'whatsapp') {
                const campaignUrl = $('#campaign-url').value;
                const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(`Check out this campaign on The Give Hub: ${campaignUrl}`)}`;
                window.open(whatsappUrl, '_blank');
                return;
            }
            
            // Prepare share content
            this.prepareShareContent(platform);
            
            this.openModal('share-modal');
        },
        
        prepareShareContent(platform) {
            const title = this.state.seoSettings.socialTitle || this.data.title || 'Campaign';
            const description = this.state.seoSettings.socialDescription || this.data.description || 'Support this campaign on The Give Hub';
            const campaignSlug = this.utils.getSlugFromTitle(this.data.title || 'campaign');
            const campaignUrl = `https://thegivehub.com/campaign/${campaignSlug}`;
            
            // Update URL field
            $('#campaign-url').value = campaignUrl;
            
            // Platform-specific preparations
            switch (platform) {
                case 'twitter':
                    // Prepare Twitter message with title and URL
                    $('#twitter-message').value = `${title} ${campaignUrl} via @GiveHub`;
                    this.updateCharacterCount('twitter-message');
                    break;
                    
                case 'linkedin':
                    // Set LinkedIn title and message
                    $('#linkedin-title').value = title;
                    $('#linkedin-message').value = description;
                    break;
                    
                case 'email':
                    // Set email subject and prepare body
                    $('#email-subject').value = `Check out this campaign: ${title}`;
                    $('#email-body').value = `Hello,\n\nI wanted to share this campaign with you from The Give Hub. \n\n${title}\n${description}\n\nYou can learn more and donate here: ${campaignUrl}\n\nThanks,\n[Your Name]`;
                    break;
            }
        },
        
        shareToPlatform(platform) {
            const title = this.state.seoSettings.socialTitle || this.data.title || 'Campaign';
            const description = this.state.seoSettings.socialDescription || this.data.description;
            const campaignUrl = $('#campaign-url').value;
            
            switch (platform) {
                case 'facebook':
                    const fbMessage = $('#facebook-message').value;
                    // Open Facebook share dialog
                    const fbShareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(campaignUrl)}&quote=${encodeURIComponent(fbMessage)}`;
                    window.open(fbShareUrl, '_blank', 'width=600,height=400');
                    break;
                    
                case 'twitter':
                    const tweetText = $('#twitter-message').value;
                    // Open Twitter share dialog
                    const twitterShareUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(tweetText)}`;
                    window.open(twitterShareUrl, '_blank', 'width=600,height=400');
                    break;
                    
                case 'linkedin':
                    const liTitle = $('#linkedin-title').value;
                    const liSummary = $('#linkedin-message').value;
                    // Open LinkedIn share dialog
                    const linkedinShareUrl = `https://www.linkedin.com/shareArticle?mini=true&url=${encodeURIComponent(campaignUrl)}&title=${encodeURIComponent(liTitle)}&summary=${encodeURIComponent(liSummary)}`;
                    window.open(linkedinShareUrl, '_blank', 'width=600,height=400');
                    break;
                    
                case 'email':
                    const emailSubject = $('#email-subject').value;
                    const emailBody = $('#email-body').value.replace('{{campaign_url}}', campaignUrl);
                    // Open email client
                    window.location.href = `mailto:?subject=${encodeURIComponent(emailSubject)}&body=${encodeURIComponent(emailBody)}`;
                    break;
            }
            
            // Close the modal
            this.closeModal('share-modal');
            this.utils.showNotification(`Campaign shared on ${platform.charAt(0).toUpperCase() + platform.slice(1)}`);
        },
        
        copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            // Select the text
            element.select();
            element.setSelectionRange(0, 99999); // For mobile devices
            
            // Copy the text
            document.execCommand('copy');
            
            // Deselect
            element.blur();
            
            // Show confirmation
            this.utils.showNotification('Link copied to clipboard');
            
            // Update button text temporarily
            const copyBtn = $('#copy-url-btn');
            const originalHtml = copyBtn.innerHTML;
            copyBtn.innerHTML = '<i class="fas fa-check"></i>';
            
            // Reset button after 2 seconds
            setTimeout(() => {
                copyBtn.innerHTML = originalHtml;
            }, 2000);
        },
        
        // Add animation effects
        animate() {
            // Animate progress bar on load
            const progressBar = $('#progress-bar-fill');
            if (progressBar) {
                progressBar.style.transition = 'none';
                progressBar.style.width = '0%';
                setTimeout(() => {
                    progressBar.style.transition = 'width 1s ease-in-out';
                    const progress = (this.data.funding.raisedAmount / this.data.funding.goalAmount) * 100;
                    progressBar.style.width = `${progress}%`;
                }, 100);
            }

            // Animate stats counting up
            const stats = $$('.stat-value');
            stats.forEach(stat => {
                const finalValue = stat.textContent;
                if (!isNaN(parseInt(finalValue))) {
                    this.utils.animateNumber(stat, 0, parseInt(finalValue), 1000);
                }
            });
        }
    };

    // Utils for number animation
    app.utils.animateNumber = function(element, start, end, duration) {
        const range = end - start;
        const startTime = performance.now();
        
        const updateNumber = (currentTime) => {
            const elapsed = currentTime - startTime;
            const progress = Math.min(elapsed / duration, 1);
            
            const currentValue = Math.floor(start + (range * progress));
            element.textContent = new Intl.NumberFormat().format(currentValue);
            
            if (progress < 1) {
                requestAnimationFrame(updateNumber);
            }
        };
        
        requestAnimationFrame(updateNumber);
    };

    window.app = app;
    document.addEventListener('DOMContentLoaded', () => app.init());
})();
</script>
</body>
</html>
